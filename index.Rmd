---
title: "TFcheckpoint Dataset visualization using UMAP"
author: "[John Zobolas](https://github.com/bblodfon)"
date: "Last updated: `r format(Sys.time(), '%d %B, %Y')`"
description: "Description"
url: 'https\://druglogics.github.io/tfcheckpoint-umap/'
github-repo: "druglogics/tfcheckpoint-umap"
bibliography: references.bib
link-citations: true
site: bookdown::bookdown_site
---

# Input {-}

Loading libraries:
```{r Load libraries, message = FALSE}
library(xfun)
library(dplyr)
library(scales)
```

# Intro {-}

TFcheckpoint [@Chawla2013] is a curated database with sequence-specific DNA-binding RNA polymerase II transcription-factor proteins (**DbTFs**).

The form of the dataset is as follows: a total of $4705$ proteins, each one represented by a row, are enriched with GO annotations (a total of $8621$ GO terms [@Carbon2019]) that indicate the presence ($1$) or absence ($0$) of a particular molecular function. 
The dataset is provided as a [tab-delimited file](https://github.com/druglogics/tfcheckpoint-umap/blob/main/data/genes2go_result_tfcheckpoint2_data.txt).

In this analysis we present a 2D visualization of this dataset using the non-linear dimension reduction method UMAP [@McInnes2018a].
This method will reduce the size of the dataset from $(4705 \times 8621)$ to $(4705 \times 2)$ while efficiently identifying groups of proteins with the same molecular characterization. 
These groups are indicated by varying size clusters in the 2D plane.

# Analysis {-}

:::{.blue-box}
See script [umap.R](https://github.com/druglogics/tfcheckpoint-umap/blob/main/scripts/umap.R) for more details about the presented analysis.
:::

## Tuning the number of neighbors {-}

We first run the UMAP on the dataset in unsupervised mode to see how well it clusters the GO-enriched protein data.
We used the default *euclidean* distance metric to find nearest neighbors for every data point (GO-annotated protein).
We first tune one of the most important parameters, i.e. the **number of neighbors**, where larger values result in more *global* views of the dataset, while smaller values result in more *local* data being preserved.
After UMAP returns the 2D optimized coordinates for the proteins, we color each protein according to its corresponding value for the *DNA binding* GO term, in order to assess if UMAP can at least distinguish between DNA binding (DbTFs) and non DNA-binding TFs (non-DbTFs).

```{r umap-neigh-1, fig.show='hold', out.width='50%', fig.cap='Unsupervised UMAP of the TFcheckpoint dataset using 2 and 4 neighbors. DbTFs are colored atop the 2D embedding.'}
knitr::include_graphics(path = 'img/tf_umap_2n.png')
knitr::include_graphics(path = 'img/tf_umap_4n.png')
```

```{r umap-neigh-2, fig.show='hold', out.width='50%', fig.cap='Unsupervised UMAP of the TFcheckpoint dataset using 6 and 8 neighbors. DbTFs are colored atop the 2D embedding.'}
knitr::include_graphics(path = 'img/tf_umap_6n.png')
knitr::include_graphics(path = 'img/tf_umap_8n.png')
```

```{r umap-neigh-3, fig.show='hold', out.width='50%', fig.cap='Unsupervised UMAP of the TFcheckpoint dataset using 10 and 12 neighbors. DbTFs proteins are colored atop the 2D embedding.'}
knitr::include_graphics(path = 'img/tf_umap_10n.png')
knitr::include_graphics(path = 'img/tf_umap_12n.png')
```

```{r umap-neigh-4, fig.show='hold', out.width='50%', fig.cap='Unsupervised UMAP of the TFcheckpoint dataset using 14 and 15 neighbors. DbTFs are colored atop the 2D embedding.'}
knitr::include_graphics(path = 'img/tf_umap_14n.png')
knitr::include_graphics(path = 'img/tf_umap_15n.png')
```

```{r umap-neigh-5, fig.show='hold', out.width='50%', fig.cap='Unsupervised UMAP of the TFcheckpoint dataset using 17 and 20 neighbors. DbTFs are colored atop the 2D embedding.'}
knitr::include_graphics(path = 'img/tf_umap_17n.png')
knitr::include_graphics(path = 'img/tf_umap_20n.png')
```

Lastly, using as basis the embedding with $12$ neighbors, we annotate two cases of DbTFs that stand out from the clustered data:
```{r umap-neigh-annot, fig.cap='Unsupervised UMAP of the TFcheckpoint dataset using 12 neighbors. DbTFs proteins are colored atop the 2D embedding. Two distinct examples of DbTFs have been annotated: the AHDC1 and the Heat shock factor proteins.'}
knitr::include_graphics(path = 'img/tf_umap_12n_annot.png')
```

:::{.green-box}
For $\ge 8-10$ neighbors, UMAP splits the dataset to $3$ distinct TF protein superclusters:

1. One of superclusters has strictly non-DbTFs and can be practically identified by one of the **reduced dimensions** (it does not matter which one you choose when observing more global views of the dataset, i.e. with larger number of neighbors, the following is enough: $X>0 \text{ or } Y<0$).
Interestingly, there is only one protein that is a DbTF and resides within this cluster as shown above and that protein is [AHDC1](https://en.wikipedia.org/wiki/AHDC1).
2. One supercluster has **mostly DbTFs**.
A set of them is somewhat apart from the parent supercluster, namely the [heat shock factor proteins](https://en.wikipedia.org/wiki/Heat_shock_factor).
The complete list includes these proteins: `HSF1`, `HSF2`, `HSF4`, `HSF5`, `HSFX1`, `HSFY1`, `HSFY2`, `HSFX2`, `HSFX3`, `HSFX4` (their $(X,Y)$ coordinates are really close and are thus presented as one point in the map).
3. One supercluster has **a mix of both DbTFs and non-DbTFs**.
Since this cluster is closer to the second one, it point to us the fact that the included non-DbTFs have molecular functions that are more similar to DbTFs compared with the far off first supercluster that includes the *pure* (so-to-speak) DbTFs.
:::

## Tuning minimum distance {-}

Choosing $15$ as a base value for the number of neighbors, we will tune the `min_dist` UMAP parameter which is the effective minimum distance between the embedded points (the default value presented in the previous figures was $0.01$).
As the documentation says, smaller `min_dist` values will result in a more clustered/clumped embedding where nearby points on the manifold are drawn closer together, while larger values will result on a more even dispersal of points.
The idea here is to keep the separation of the $3$ superclusters as much as possible, while *spreading out* the embedded points.

```{r umap-min-dist-1, fig.show='hold', out.width='50%', fig.cap='Unsupervised UMAP of the TFcheckpoint dataset using 15 neighbors and different values of the `mind_dist` parameter. DbTFs are colored atop the 2D embedding.'}
knitr::include_graphics(path = 'img/tf_umap_15n_mindist_0.05.png')
knitr::include_graphics(path = 'img/tf_umap_15n_mindist_0.1.png')
```

```{r umap-min-dist-2, fig.show='hold', out.width='50%', fig.cap='Unsupervised UMAP of the TFcheckpoint dataset using 15 neighbors and different values of the `mind_dist` parameter. DbTFs are colored atop the 2D embedding.'}
knitr::include_graphics(path = 'img/tf_umap_15n_mindist_0.3.png')
knitr::include_graphics(path = 'img/tf_umap_15n_mindist_0.5.png')
```

```{r umap-min-dist-3, fig.show='hold', out.width='50%', fig.cap='Unsupervised UMAP of the TFcheckpoint dataset using 15 neighbors and different values of the `mind_dist` parameter. DbTFs are colored atop the 2D embedding.'}
knitr::include_graphics(path = 'img/tf_umap_15n_mindist_0.7.png')
knitr::include_graphics(path = 'img/tf_umap_15n_mindist_1.png')
```

:::{.green-box}
For `min_dist` $\gt 0.1$, the separation of the superclusters (specifically for the $2$ top-left ones) dissolves.
:::

## GREEKC curated DbTF list {-}

Members of the [GREEKC](https://www.greekc.org/) consortium curated a list of DbTFs.
Comparing this list with the proteins that have the GO term `DNA binding` in the TF checkpoint dataset we have the following contingency table ($1$ corresponds to a DbTF label, $0$ to a non-DbTF label):
```{r, cache=TRUE}
dbtf_stats = readRDS(file = 'data/dbtfs_go_greekc_stats.rds')
knitr::kable(dbtf_stats)
```

We calculate the percent agreement and Cohen's $\kappa$:
```{r agreement-score-calc, comment=''}
n_total = dbtf_stats$n %>% sum()
data_00 = dbtf_stats %>% filter(`GO-DbTF` == 0, `GREEKC-DbTF` == 0) %>% pull(n)
data_10 = dbtf_stats %>% filter(`GO-DbTF` == 1, `GREEKC-DbTF` == 0) %>% pull(n)
data_01 = dbtf_stats %>% filter(`GO-DbTF` == 0, `GREEKC-DbTF` == 1) %>% pull(n)
data_11 = dbtf_stats %>% filter(`GO-DbTF` == 1, `GREEKC-DbTF` == 1) %>% pull(n)

# calculate percent agreement
percent = (data_00 + data_11)/n_total
scales::percent(percent)

# Cohen's kappa
p0 = (data_00 + data_01)/n_total * (data_00 + data_10)/n_total
p1 = (data_11 + data_01)/n_total * (data_11 + data_10)/n_total
p_rand = p0 + p1
cohen_k = (percent - p_rand)/(1 - p_rand)
scales::percent(cohen_k)
```

:::{.green-box}
There is a **substantial level of agreement** between the GO DNA-binding annotation and the DbTF GREEKC list.
:::

Using the UMAP coordinates with $12$ neighbors, we color the data points according to the GREEKC annotated DbTFs labels:
```{r umap-12n-greekc, fig.cap = 'Unsupervised UMAP of the TFcheckpoint dataset using 12 neighbors. DbTFs proteins according to the curated GREEKC list are colored atop the 2D embedding.'}
knitr::include_graphics(path = 'img/tf_umap_12n_greekc.png')
```

We also color the same points according to the values presented in the contingency table above (including thus all $4$ cases of proteins as annotated by the GREEKC and the DNA-binding GO term):
```{r umap-12n-go-greekc, fig.cap = 'Unsupervised UMAP of the TFcheckpoint dataset using 12 neighbors. Proteins are pre-assigned to 4 groups depending on the value of the corresponding DNA-binding GO term and if are in the curated GREEKC list of DbTFs.'}
knitr::include_graphics(path = 'img/tf_umap_12n_go_greekc.png')
```

:::{.green-box}
- There are a lot more DbTFs now residing inside the non-DbTF supercluster (top right)
- The bottom left supercluster with no DbTFs has become a bit more distinguished, i.e. almost all it's points are non-DbTFs according to the GREEKC list information.
- Maybe the curated list better reflects the clustered data than the DNA-binding GO term thus?
:::

# R session info {-}

```{r session info, comment="", class.source = 'fold-show'}
xfun::session_info()
```

# References {-}
